{{- /* iSCSI CHAP Secret (created from values if credentials provided) */ -}}
{{- if and .Values.storageClassIscsi.create (not .Values.storageClassIscsi.chapSecret.name) }}
{{- if .Values.storageClassIscsi.chapSecret.credentials.username }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "freebsd-csi.fullname" . }}-chap
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "freebsd-csi.labels" . | nindent 4 }}
type: Opaque
stringData:
  node.session.auth.username: {{ .Values.storageClassIscsi.chapSecret.credentials.username | quote }}
  node.session.auth.password: {{ .Values.storageClassIscsi.chapSecret.credentials.password | quote }}
  {{- if .Values.storageClassIscsi.chapSecret.credentials.usernameIn }}
  node.session.auth.username_in: {{ .Values.storageClassIscsi.chapSecret.credentials.usernameIn | quote }}
  node.session.auth.password_in: {{ .Values.storageClassIscsi.chapSecret.credentials.passwordIn | quote }}
  {{- end }}
---
{{- end }}
{{- end }}
{{- /* NVMeoF Auth Secret (created from values if credentials provided) */ -}}
{{- if and .Values.storageClassNvmeof.create (not .Values.storageClassNvmeof.authSecret.name) }}
{{- if .Values.storageClassNvmeof.authSecret.credentials.hostNqn }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "freebsd-csi.fullname" . }}-nvme-auth
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "freebsd-csi.labels" . | nindent 4 }}
type: Opaque
stringData:
  nvme.auth.host_nqn: {{ .Values.storageClassNvmeof.authSecret.credentials.hostNqn | quote }}
  {{- if .Values.storageClassNvmeof.authSecret.credentials.secret }}
  nvme.auth.secret: {{ .Values.storageClassNvmeof.authSecret.credentials.secret | quote }}
  {{- end }}
  {{- if .Values.storageClassNvmeof.authSecret.credentials.hashFunction }}
  nvme.auth.hash_function: {{ .Values.storageClassNvmeof.authSecret.credentials.hashFunction | quote }}
  {{- end }}
  {{- if .Values.storageClassNvmeof.authSecret.credentials.dhGroup }}
  nvme.auth.dh_group: {{ .Values.storageClassNvmeof.authSecret.credentials.dhGroup | quote }}
  {{- end }}
{{- end }}
{{- end }}
