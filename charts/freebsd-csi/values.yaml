# FreeBSD CSI Driver Helm Chart Values

nameOverride: ""
fullnameOverride: ""

# CSI driver image
image:
  repository: ghcr.io/ndenev/freebsd-csi-driver
  # Defaults to appVersion if empty
  tag: ""
  pullPolicy: IfNotPresent

imagePullSecrets: []

# CSI driver configuration
driver:
  # CSI driver name (do not change unless you know what you're doing)
  name: csi.freebsd.org
  # Log level: trace, debug, info, warn, error
  logLevel: info

# ctld-agent connection settings
# NOTE: ctld-agent runs on an EXTERNAL FreeBSD storage server, NOT in Kubernetes
agent:
  # gRPC endpoint of the ctld-agent (REQUIRED - must be reachable from cluster)
  # This is the FreeBSD storage server running ctld-agent
  # Examples:
  #   - "http://192.168.1.100:50051" (plaintext)
  #   - "https://storage.example.com:50051" (TLS)
  endpoint: ""

# TLS configuration for mTLS with ctld-agent
tls:
  enabled: false
  # Use an existing secret containing ca.crt, tls.crt, tls.key
  existingSecret: ""
  # Or provide certificates directly (will create a secret)
  # Values should be base64 encoded
  caCert: ""
  clientCert: ""
  clientKey: ""
  # TLS domain name for server certificate verification
  domain: "ctld-agent"

# Controller deployment settings
controller:
  replicas: 1
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 256Mi
  nodeSelector: {}
  tolerations: []
  affinity: {}
  # Priority class name for controller pods
  priorityClassName: ""
  # Liveness probe configuration
  livenessProbe:
    exec:
      command:
        - /bin/sh
        - -c
        - test -S /csi/csi.sock
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 3
    failureThreshold: 5
  # Readiness probe configuration
  readinessProbe:
    exec:
      command:
        - /bin/sh
        - -c
        - test -S /csi/csi.sock
    initialDelaySeconds: 5
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

# Node DaemonSet settings
node:
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 256Mi
  nodeSelector: {}
  # Default: tolerate all taints so driver runs on all nodes
  tolerations:
    - operator: Exists
  affinity: {}
  # Priority class name for node pods
  priorityClassName: ""
  # Liveness probe configuration
  livenessProbe:
    exec:
      command:
        - /bin/sh
        - -c
        - test -S /csi/csi.sock
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 3
    failureThreshold: 5
  # Readiness probe configuration
  readinessProbe:
    exec:
      command:
        - /bin/sh
        - -c
        - test -S /csi/csi.sock
    initialDelaySeconds: 5
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

# CSI sidecar container images
sidecars:
  provisioner:
    image: registry.k8s.io/sig-storage/csi-provisioner:v4.0.0
  attacher:
    image: registry.k8s.io/sig-storage/csi-attacher:v4.5.0
  resizer:
    image: registry.k8s.io/sig-storage/csi-resizer:v1.10.0
  snapshotter:
    image: registry.k8s.io/sig-storage/csi-snapshotter:v7.0.1
  registrar:
    image: registry.k8s.io/sig-storage/csi-node-driver-registrar:v2.10.0
  # Resources for all sidecar containers
  resources:
    requests:
      cpu: 10m
      memory: 32Mi
    limits:
      cpu: 100m
      memory: 128Mi

# ServiceAccount configuration
serviceAccount:
  # Create a ServiceAccount for the controller
  create: true
  # Name override (defaults to fullname)
  name: ""
  # Annotations to add to the ServiceAccount
  annotations: {}

# RBAC configuration
rbac:
  # Create ClusterRole and ClusterRoleBinding
  create: true

# Storage Classes configuration
# You can create both iSCSI and NVMeoF storage classes

# iSCSI Storage Class
storageClassIscsi:
  # Set to true to create an iSCSI StorageClass
  create: false
  name: freebsd-zfs-iscsi
  # Set as default StorageClass
  default: false
  reclaimPolicy: Delete
  volumeBindingMode: Immediate
  allowVolumeExpansion: true
  # iSCSI parameters (REQUIRED if create: true)
  parameters:
    fsType: ext4
    # Portal address - IP:port of the iSCSI target (REQUIRED when create: true)
    # For multipath: use comma-separated portals, e.g., "10.0.0.10:3260,10.0.0.11:3260"
    # Each portal will be discovered and logged into separately.
    # dm-multipath will combine the paths automatically.
    portal: ""
  # CHAP Authentication (optional)
  # Option 1: Reference an existing secret by name
  # Option 2: Create a secret from values (see credentials below)
  # Secret keys:
  #   node.session.auth.username - CHAP username
  #   node.session.auth.password - CHAP secret
  #   node.session.auth.username_in - Mutual CHAP username (optional)
  #   node.session.auth.password_in - Mutual CHAP secret (optional)
  chapSecret:
    # Name of an existing secret (if set, credentials below are ignored)
    name: ""
    # Namespace of the secret (defaults to release namespace)
    namespace: ""
    # Create a secret from these credentials (ignored if name is set)
    # Note: Consider using external secrets management for production
    credentials:
      username: ""
      password: ""
      # Mutual CHAP (optional - target authenticates to initiator)
      usernameIn: ""
      passwordIn: ""

# NVMeoF Storage Class (FreeBSD 15.0+)
storageClassNvmeof:
  # Set to true to create an NVMeoF StorageClass
  create: false
  name: freebsd-zfs-nvmeof
  # Set as default StorageClass
  default: false
  reclaimPolicy: Delete
  volumeBindingMode: Immediate
  allowVolumeExpansion: true
  # NVMeoF parameters (REQUIRED if create: true)
  parameters:
    fsType: ext4
    # Transport address - IP of the NVMeoF target (REQUIRED when create: true)
    # For multipath: use comma-separated addresses, e.g., "10.0.0.10,10.0.0.11"
    # Each address will be connected separately.
    # Native NVMe multipath or dm-multipath will combine the paths.
    transportAddr: ""
    # Transport port (default: 4420)
    transportPort: "4420"
  # NVMeoF Access Control (optional, FreeBSD 15.0+)
  # Note: FreeBSD 15's ctld only supports host-nqn based access control for NVMeoF.
  #       DH-HMAC-CHAP is not yet implemented in ctld.
  # Option 1: Reference an existing secret by name
  # Option 2: Create a secret from values (see credentials below)
  # Secret keys:
  #   nvme.auth.host_nqn - Host NQN allowed to connect (required)
  #   nvme.auth.secret - Reserved for future DH-HMAC-CHAP support
  #   nvme.auth.hash_function - Reserved for future DH-HMAC-CHAP support
  #   nvme.auth.dh_group - Reserved for future DH-HMAC-CHAP support
  authSecret:
    # Name of an existing secret (if set, credentials below are ignored)
    name: ""
    # Namespace of the secret (defaults to release namespace)
    namespace: ""
    # Create a secret from these credentials (ignored if name is set)
    # Note: Consider using external secrets management for production
    credentials:
      # Host NQN allowed to connect (required for access control)
      hostNqn: ""
      # Reserved for future DH-HMAC-CHAP support
      secret: ""
      hashFunction: ""
      dhGroup: ""

# Prometheus metrics configuration
metrics:
  # Enable metrics endpoint
  enabled: false
  # Port for the metrics HTTP server
  port: 9090
  # Create a Prometheus ServiceMonitor resource
  serviceMonitor:
    # Create a ServiceMonitor for the Prometheus Operator
    enabled: false
    # Additional labels for the ServiceMonitor
    labels: {}
    # Scrape interval (defaults to Prometheus default)
    interval: ""
    # Scrape timeout (defaults to Prometheus default)
    scrapeTimeout: ""
